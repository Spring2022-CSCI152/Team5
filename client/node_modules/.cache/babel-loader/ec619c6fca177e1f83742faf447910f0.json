{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\gabe\\\\Desktop\\\\Pomo\\\\Team5\\\\client\\\\src\\\\components\\\\TimerPage\\\\TimerPage.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect } from 'react';\nimport { Button, Box, ButtonGroup } from '@material-ui/core';\nimport Stack from '@mui/material/Stack';\nimport LinearProgress from '@mui/material/LinearProgress';\nimport axios from 'axios';\nimport { getUser } from \"../../services/ApiCalls\";\nimport Timer from './TimerDisplay/Timer';\nimport CharacterDisplay from './TimerDisplay/CharacterDisplay';\nimport RoomDisplay from './TimerDisplay/RoomDisplay';\nimport QuestDisplay from './TimerDisplay/QuestDisplay';\nimport TimeMath from '../../services/TimeMath'; // Menu\n\nimport TimerAdjust from '../TimerPage/Menu/TimerAdjust';\nimport FriendsList from '../TimerPage/Menu/FriendsList';\nimport ItemShop from '../TimerPage/Menu/ItemShop';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction TimerPage() {\n  _s();\n\n  const [pomodoro, setPomodoro] = useState(25);\n  const [shortBreak, setShortBreak] = useState(5);\n  const [longBreak, setLongBreak] = useState(20);\n  const [timerSeconds, setTimerSeconds] = useState(TimeMath.convMinSec(pomodoro));\n  const [timerMode, setTimerMode] = useState('Questing');\n  const [isRunning, setIsRunning] = useState(false);\n  const [pomosCompleted, setPomosCompleted] = useState(0);\n  const [activeTask, setActiveTask] = useState('');\n  const [character, setCharacter] = useState({\n    char_name: \"\",\n    stats: {},\n    inventory: []\n  }); // Can probably refactor this into a smaller component, but for now it is easier to see how everything working\n  // Gold: Plus 20 gold per each finished study timer,\n  // plus 100 per each long break achieved\n  //\n  // XP: Plus 50 xp per each finished study timer,\n  // plus 200 for each long break achieved\n  //\n\n  const questComplete = type => {\n    let updatedXp = type === \"LC\" ? character.stats.current_xp + 100 : character.stats.current_xp + 50;\n    const updatedGold = type === \"LC\" ? character.stats.gold + 100 : character.stats.gold + 50;\n    let updatedLevel = character.stats.level;\n    let updatedReqExp = character.stats.xp_to_next_level;\n\n    if (updatedXp >= character.stats.xp_to_next_level) {\n      updatedXp = 0;\n      updatedLevel = updatedLevel + 1;\n      updatedReqExp = updatedReqExp + 100;\n    }\n\n    let updatedCharacter = {\n      current_xp: updatedXp,\n      gold: updatedGold,\n      level: updatedLevel,\n      xp_to_next_level: updatedReqExp\n    };\n    setCharacter({ ...character,\n      stats: { ...character.stats,\n        gold: updatedGold,\n        current_xp: updatedXp,\n        level: updatedLevel,\n        xp_to_next_level: updatedReqExp\n      }\n    }); // error when trying to post a 0 to updatedXP stat\n\n    axios.put(`http://localhost:5000/api/v1/users/character`, updatedCharacter).then(r => console.log(r)).catch(e => console.log(e.response));\n  };\n\n  const handleModeChange = () => {\n    if (timerMode === 'Questing' && pomosCompleted === 3) {\n      setTimerMode('Long Camp');\n      setPomosCompleted(pomosCompleted => pomosCompleted + 1);\n      setTimerSeconds(TimeMath.convMinSec(longBreak));\n      questComplete(\"LC\");\n    } else if (timerMode === 'Questing') {\n      setTimerMode('Short Camp');\n      setTimerSeconds(TimeMath.convMinSec(shortBreak));\n      setPomosCompleted(pomosCompleted => pomosCompleted + 1);\n      questComplete(\"Q\");\n    } else {\n      setTimerMode('Questing');\n      setTimerSeconds(TimeMath.convMinSec(pomodoro));\n    }\n  };\n\n  const timeoutID = 0;\n  useEffect(() => {\n    getUser().then(response => {\n      setCharacter(response.data);\n    }).catch(error => {\n      console.log(error);\n    });\n  }, []);\n  useEffect(() => {\n    if (isRunning && timerSeconds > 0) {\n      const timeoutID = setTimeout(() => {\n        setTimerSeconds(timerSeconds => timerSeconds - 1);\n      }, 1000);\n    }\n\n    if (timerSeconds === 0) {\n      setIsRunning(false);\n      clearTimeout(timeoutID);\n      handleModeChange();\n    }\n\n    clearTimeout(timeoutID);\n  }, [isRunning, timerSeconds]);\n  return /*#__PURE__*/_jsxDEV(Box, {\n    sx: {\n      display: 'flex',\n      justifyContent: 'center',\n      textAlign: 'center',\n      alignItems: 'baseline',\n      pt: 5,\n      pb: 5\n    },\n    children: [/*#__PURE__*/_jsxDEV(RoomDisplay, {\n      pomosCompleted: pomosCompleted,\n      multiplier: 1\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 15\n    }, this), /*#__PURE__*/_jsxDEV(Box, {\n      children: [/*#__PURE__*/_jsxDEV(Box, {\n        sx: {\n          mb: 5,\n          minWidth: 400\n        },\n        children: [/*#__PURE__*/_jsxDEV(LinearProgress, {\n          variant: \"determinate\",\n          value: TimeMath.normalise(Math.abs(timerSeconds - TimeMath.convMinSec(pomodoro)), pomodoro),\n          sx: {\n            height: 12,\n            width: '100%'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 123,\n          columnNumber: 23\n        }, this), /*#__PURE__*/_jsxDEV(Timer, {\n          timerMode: timerMode,\n          timer: TimeMath.formatSeconds(timerSeconds),\n          reward: pomosCompleted % 2 === 0 ? '`Gold`' : 'Exp',\n          activeTask: activeTask\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 124,\n          columnNumber: 23\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 122,\n        columnNumber: 19\n      }, this), /*#__PURE__*/_jsxDEV(ButtonGroup, {\n        variant: 'contained',\n        children: [/*#__PURE__*/_jsxDEV(Button, {\n          onClick: () => setIsRunning(true),\n          children: \"START\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 132,\n          columnNumber: 23\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          onClick: () => {\n            setIsRunning(false);\n            clearTimeout(timeoutID);\n          },\n          children: \"STOP\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 133,\n          columnNumber: 23\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 131,\n        columnNumber: 19\n      }, this), /*#__PURE__*/_jsxDEV(QuestDisplay, {\n        setActiveTask: setActiveTask\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 138,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 15\n    }, this), /*#__PURE__*/_jsxDEV(Box, {\n      sx: {\n        ml: 10,\n        width: '9%',\n        display: 'flex',\n        flexDirection: 'column',\n        alignItems: 'center'\n      },\n      children: [/*#__PURE__*/_jsxDEV(CharacterDisplay, {\n        character: character,\n        setCharacter: setCharacter\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 142,\n        columnNumber: 19\n      }, this), /*#__PURE__*/_jsxDEV(Stack, {\n        direction: 'row',\n        children: [/*#__PURE__*/_jsxDEV(TimerAdjust, {\n          pomodoro: pomodoro,\n          setPomodoro: setPomodoro,\n          shortBreak: shortBreak,\n          setShortBreak: setShortBreak,\n          longBreak: longBreak,\n          setLongBreak: setLongBreak,\n          setTimerSeconds: setTimerSeconds\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 144,\n          columnNumber: 27\n        }, this), /*#__PURE__*/_jsxDEV(FriendsList, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 145,\n          columnNumber: 27\n        }, this), /*#__PURE__*/_jsxDEV(ItemShop, {\n          character: character,\n          setCharacter: setCharacter\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 146,\n          columnNumber: 27\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 143,\n        columnNumber: 19\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 15\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 111,\n    columnNumber: 11\n  }, this);\n}\n\n_s(TimerPage, \"W78gtH1rpfqqJFp6BVdqyLgJ4Ok=\");\n\n_c = TimerPage;\nexport default TimerPage;\n\nvar _c;\n\n$RefreshReg$(_c, \"TimerPage\");","map":{"version":3,"sources":["C:/Users/gabe/Desktop/Pomo/Team5/client/src/components/TimerPage/TimerPage.js"],"names":["React","useState","useEffect","Button","Box","ButtonGroup","Stack","LinearProgress","axios","getUser","Timer","CharacterDisplay","RoomDisplay","QuestDisplay","TimeMath","TimerAdjust","FriendsList","ItemShop","TimerPage","pomodoro","setPomodoro","shortBreak","setShortBreak","longBreak","setLongBreak","timerSeconds","setTimerSeconds","convMinSec","timerMode","setTimerMode","isRunning","setIsRunning","pomosCompleted","setPomosCompleted","activeTask","setActiveTask","character","setCharacter","char_name","stats","inventory","questComplete","type","updatedXp","current_xp","updatedGold","gold","updatedLevel","level","updatedReqExp","xp_to_next_level","updatedCharacter","put","then","r","console","log","catch","e","response","handleModeChange","timeoutID","data","error","setTimeout","clearTimeout","display","justifyContent","textAlign","alignItems","pt","pb","mb","minWidth","normalise","Math","abs","height","width","formatSeconds","ml","flexDirection"],"mappings":";;;AAAA,OAAOA,KAAP,IAAeC,QAAf,EAAyBC,SAAzB,QAAyC,OAAzC;AACA,SAAQC,MAAR,EAAgBC,GAAhB,EAAqBC,WAArB,QAAuC,mBAAvC;AACA,OAAOC,KAAP,MAAkB,qBAAlB;AACA,OAAOC,cAAP,MAA2B,8BAA3B;AAEA,OAAOC,KAAP,MAAkB,OAAlB;AACA,SAAQC,OAAR,QAAsB,yBAAtB;AAEA,OAAOC,KAAP,MAAkB,sBAAlB;AACA,OAAOC,gBAAP,MAA6B,iCAA7B;AACA,OAAOC,WAAP,MAAwB,4BAAxB;AACA,OAAOC,YAAP,MAAyB,6BAAzB;AACA,OAAOC,QAAP,MAAqB,yBAArB,C,CACA;;AACA,OAAOC,WAAP,MAAwB,+BAAxB;AACA,OAAOC,WAAP,MAAwB,+BAAxB;AACA,OAAOC,QAAP,MAAqB,4BAArB;;;AAEA,SAASC,SAAT,GAAqB;AAAA;;AAEjB,QAAM,CAAEC,QAAF,EAAaC,WAAb,IAA6BnB,QAAQ,CAAC,EAAD,CAA3C;AACA,QAAM,CAAEoB,UAAF,EAAeC,aAAf,IAAiCrB,QAAQ,CAAC,CAAD,CAA/C;AACA,QAAM,CAAEsB,SAAF,EAAcC,YAAd,IAA+BvB,QAAQ,CAAC,EAAD,CAA7C;AACA,QAAM,CAAEwB,YAAF,EAAiBC,eAAjB,IAAqCzB,QAAQ,CAACa,QAAQ,CAACa,UAAT,CAAoBR,QAApB,CAAD,CAAnD;AACA,QAAM,CAAES,SAAF,EAAcC,YAAd,IAA+B5B,QAAQ,CAAC,UAAD,CAA7C;AACA,QAAM,CAAE6B,SAAF,EAAaC,YAAb,IAA8B9B,QAAQ,CAAC,KAAD,CAA5C;AACA,QAAM,CAAE+B,cAAF,EAAkBC,iBAAlB,IAAwChC,QAAQ,CAAC,CAAD,CAAtD;AACA,QAAM,CAAEiC,UAAF,EAAcC,aAAd,IAAgClC,QAAQ,CAAC,EAAD,CAA9C;AACA,QAAM,CAAEmC,SAAF,EAAaC,YAAb,IAA8BpC,QAAQ,CAAC;AAACqC,IAAAA,SAAS,EAAE,EAAZ;AAAgBC,IAAAA,KAAK,EAAE,EAAvB;AAA2BC,IAAAA,SAAS,EAAE;AAAtC,GAAD,CAA5C,CAViB,CAWjB;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,QAAMC,aAAa,GAAIC,IAAD,IAAU;AAE5B,QAAIC,SAAS,GAAGD,IAAI,KAAK,IAAT,GAAgBN,SAAS,CAACG,KAAV,CAAgBK,UAAhB,GAA6B,GAA7C,GAAmDR,SAAS,CAACG,KAAV,CAAgBK,UAAhB,GAA6B,EAAhG;AACA,UAAMC,WAAW,GAAGH,IAAI,KAAK,IAAT,GAAgBN,SAAS,CAACG,KAAV,CAAgBO,IAAhB,GAAuB,GAAvC,GAA6CV,SAAS,CAACG,KAAV,CAAgBO,IAAhB,GAAuB,EAAxF;AACA,QAAIC,YAAY,GAAGX,SAAS,CAACG,KAAV,CAAgBS,KAAnC;AACA,QAAIC,aAAa,GAAGb,SAAS,CAACG,KAAV,CAAgBW,gBAApC;;AAEA,QAAIP,SAAS,IAAIP,SAAS,CAACG,KAAV,CAAgBW,gBAAjC,EAAmD;AAC/CP,MAAAA,SAAS,GAAG,CAAZ;AACAI,MAAAA,YAAY,GAAGA,YAAY,GAAG,CAA9B;AACAE,MAAAA,aAAa,GAAGA,aAAa,GAAG,GAAhC;AACH;;AAED,QAAIE,gBAAgB,GAAG;AACnBP,MAAAA,UAAU,EAAED,SADO;AAEnBG,MAAAA,IAAI,EAAED,WAFa;AAGnBG,MAAAA,KAAK,EAAED,YAHY;AAInBG,MAAAA,gBAAgB,EAAED;AAJC,KAAvB;AAOAZ,IAAAA,YAAY,CAAC,EAAC,GAAGD,SAAJ;AAAeG,MAAAA,KAAK,EAAE,EAAC,GAAGH,SAAS,CAACG,KAAd;AAAqBO,QAAAA,IAAI,EAAED,WAA3B;AAAwCD,QAAAA,UAAU,EAAED,SAApD;AAA+DK,QAAAA,KAAK,EAAED,YAAtE;AAAoFG,QAAAA,gBAAgB,EAAED;AAAtG;AAAtB,KAAD,CAAZ,CApB4B,CAqB5B;;AACAzC,IAAAA,KAAK,CAAC4C,GAAN,CAAW,8CAAX,EAA0DD,gBAA1D,EACKE,IADL,CACUC,CAAC,IAAIC,OAAO,CAACC,GAAR,CAAYF,CAAZ,CADf,EAEKG,KAFL,CAEWC,CAAC,IAAIH,OAAO,CAACC,GAAR,CAAYE,CAAC,CAACC,QAAd,CAFhB;AAGH,GAzBD;;AA0BA,QAAMC,gBAAgB,GAAG,MAAM;AAC7B,QAAIhC,SAAS,KAAK,UAAd,IAA4BI,cAAc,KAAK,CAAnD,EAAqD;AACjDH,MAAAA,YAAY,CAAC,WAAD,CAAZ;AACAI,MAAAA,iBAAiB,CAACD,cAAc,IAAIA,cAAc,GAAG,CAApC,CAAjB;AACAN,MAAAA,eAAe,CAACZ,QAAQ,CAACa,UAAT,CAAoBJ,SAApB,CAAD,CAAf;AACAkB,MAAAA,aAAa,CAAC,IAAD,CAAb;AACH,KALD,MAMK,IAAIb,SAAS,KAAK,UAAlB,EAA6B;AAC9BC,MAAAA,YAAY,CAAC,YAAD,CAAZ;AACAH,MAAAA,eAAe,CAACZ,QAAQ,CAACa,UAAT,CAAoBN,UAApB,CAAD,CAAf;AACAY,MAAAA,iBAAiB,CAACD,cAAc,IAAIA,cAAc,GAAG,CAApC,CAAjB;AACAS,MAAAA,aAAa,CAAC,GAAD,CAAb;AACH,KALI,MAKC;AACFZ,MAAAA,YAAY,CAAC,UAAD,CAAZ;AACAH,MAAAA,eAAe,CAACZ,QAAQ,CAACa,UAAT,CAAoBR,QAApB,CAAD,CAAf;AAEH;AACF,GAjBD;;AAkBA,QAAM0C,SAAS,GAAG,CAAlB;AAEA3D,EAAAA,SAAS,CAAC,MAAM;AACZO,IAAAA,OAAO,GACF4C,IADL,CAEQM,QAAQ,IAAI;AACRtB,MAAAA,YAAY,CAACsB,QAAQ,CAACG,IAAV,CAAZ;AACH,KAJT,EAMKL,KANL,CAMWM,KAAK,IAAI;AACZR,MAAAA,OAAO,CAACC,GAAR,CAAYO,KAAZ;AACH,KARL;AAUH,GAXQ,EAWN,EAXM,CAAT;AAaA7D,EAAAA,SAAS,CAAC,MAAM;AACZ,QAAG4B,SAAS,IAAIL,YAAY,GAAG,CAA/B,EAAkC;AAC9B,YAAMoC,SAAS,GAAGG,UAAU,CAAC,MAAM;AAC/BtC,QAAAA,eAAe,CAACD,YAAY,IAAIA,YAAY,GAAG,CAAhC,CAAf;AACH,OAF2B,EAEzB,IAFyB,CAA5B;AAGH;;AACD,QAAIA,YAAY,KAAK,CAArB,EAAuB;AACnBM,MAAAA,YAAY,CAAC,KAAD,CAAZ;AACAkC,MAAAA,YAAY,CAACJ,SAAD,CAAZ;AACAD,MAAAA,gBAAgB;AACnB;;AACDK,IAAAA,YAAY,CAACJ,SAAD,CAAZ;AACH,GAZQ,EAYN,CAAC/B,SAAD,EAAYL,YAAZ,CAZM,CAAT;AAcF,sBACQ,QAAC,GAAD;AAAK,IAAA,EAAE,EAAE;AACLyC,MAAAA,OAAO,EAAE,MADJ;AAELC,MAAAA,cAAc,EAAE,QAFX;AAGLC,MAAAA,SAAS,EAAE,QAHN;AAILC,MAAAA,UAAU,EAAE,UAJP;AAKLC,MAAAA,EAAE,EAAE,CALC;AAKEC,MAAAA,EAAE,EAAE;AALN,KAAT;AAAA,4BAQI,QAAC,WAAD;AAAa,MAAA,cAAc,EAAEvC,cAA7B;AAA6C,MAAA,UAAU,EAAE;AAAzD;AAAA;AAAA;AAAA;AAAA,YARJ,eAUI,QAAC,GAAD;AAAA,8BACI,QAAC,GAAD;AAAK,QAAA,EAAE,EAAE;AAACwC,UAAAA,EAAE,EAAE,CAAL;AAAQC,UAAAA,QAAQ,EAAE;AAAlB,SAAT;AAAA,gCACI,QAAC,cAAD;AAAgB,UAAA,OAAO,EAAC,aAAxB;AAAsC,UAAA,KAAK,EAAE3D,QAAQ,CAAC4D,SAAT,CAAmBC,IAAI,CAACC,GAAL,CAASnD,YAAY,GAAGX,QAAQ,CAACa,UAAT,CAAoBR,QAApB,CAAxB,CAAnB,EAA0EA,QAA1E,CAA7C;AAAkI,UAAA,EAAE,EAAE;AAAC0D,YAAAA,MAAM,EAAE,EAAT;AAAaC,YAAAA,KAAK,EAAE;AAApB;AAAtI;AAAA;AAAA;AAAA;AAAA,gBADJ,eAEI,QAAC,KAAD;AACI,UAAA,SAAS,EAAElD,SADf;AAEI,UAAA,KAAK,EAAEd,QAAQ,CAACiE,aAAT,CAAuBtD,YAAvB,CAFX;AAGI,UAAA,MAAM,EAAEO,cAAc,GAAG,CAAjB,KAAuB,CAAvB,GAA2B,QAA3B,GAAsC,KAHlD;AAII,UAAA,UAAU,EAAIE;AAJlB;AAAA;AAAA;AAAA;AAAA,gBAFJ;AAAA;AAAA;AAAA;AAAA;AAAA,cADJ,eAUI,QAAC,WAAD;AAAa,QAAA,OAAO,EAAE,WAAtB;AAAA,gCACI,QAAC,MAAD;AAAQ,UAAA,OAAO,EAAE,MAAMH,YAAY,CAAC,IAAD,CAAnC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBADJ,eAEI,QAAC,MAAD;AAAQ,UAAA,OAAO,EAAE,MAAM;AACnBA,YAAAA,YAAY,CAAC,KAAD,CAAZ;AACAkC,YAAAA,YAAY,CAACJ,SAAD,CAAZ;AACH,WAHD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBAFJ;AAAA;AAAA;AAAA;AAAA;AAAA,cAVJ,eAiBE,QAAC,YAAD;AAAc,QAAA,aAAa,EAAE1B;AAA7B;AAAA;AAAA;AAAA;AAAA,cAjBF;AAAA;AAAA;AAAA;AAAA;AAAA,YAVJ,eA8BI,QAAC,GAAD;AAAK,MAAA,EAAE,EAAE;AAAC6C,QAAAA,EAAE,EAAE,EAAL;AAASF,QAAAA,KAAK,EAAE,IAAhB;AAAsBZ,QAAAA,OAAO,EAAE,MAA/B;AAAuCe,QAAAA,aAAa,EAAE,QAAtD;AAAgEZ,QAAAA,UAAU,EAAE;AAA5E,OAAT;AAAA,8BACI,QAAC,gBAAD;AAAkB,QAAA,SAAS,EAAEjC,SAA7B;AAAwC,QAAA,YAAY,EAAEC;AAAtD;AAAA;AAAA;AAAA;AAAA,cADJ,eAEI,QAAC,KAAD;AAAO,QAAA,SAAS,EAAE,KAAlB;AAAA,gCACQ,QAAC,WAAD;AAAa,UAAA,QAAQ,EAAElB,QAAvB;AAAiC,UAAA,WAAW,EAAEC,WAA9C;AAA2D,UAAA,UAAU,EAAEC,UAAvE;AAAmF,UAAA,aAAa,EAAEC,aAAlG;AAAiH,UAAA,SAAS,EAAEC,SAA5H;AAAuI,UAAA,YAAY,EAAEC,YAArJ;AAAmK,UAAA,eAAe,EAAEE;AAApL;AAAA;AAAA;AAAA;AAAA,gBADR,eAEQ,QAAC,WAAD;AAAA;AAAA;AAAA;AAAA,gBAFR,eAGQ,QAAC,QAAD;AAAU,UAAA,SAAS,EAAEU,SAArB;AAAgC,UAAA,YAAY,EAAEC;AAA9C;AAAA;AAAA;AAAA;AAAA,gBAHR;AAAA;AAAA;AAAA;AAAA;AAAA,cAFJ;AAAA;AAAA;AAAA;AAAA;AAAA,YA9BJ;AAAA;AAAA;AAAA;AAAA;AAAA,UADR;AAyCD;;GApIQnB,S;;KAAAA,S;AAsIT,eAAeA,SAAf","sourcesContent":["import React, {useState, useEffect} from 'react'\r\nimport {Button, Box, ButtonGroup} from '@material-ui/core';\r\nimport Stack from '@mui/material/Stack'\r\nimport LinearProgress from '@mui/material/LinearProgress';\r\n\r\nimport axios from 'axios';\r\nimport {getUser} from \"../../services/ApiCalls\";\r\n\r\nimport Timer from './TimerDisplay/Timer'\r\nimport CharacterDisplay from './TimerDisplay/CharacterDisplay'\r\nimport RoomDisplay from './TimerDisplay/RoomDisplay'\r\nimport QuestDisplay from './TimerDisplay/QuestDisplay'\r\nimport TimeMath from '../../services/TimeMath'\r\n// Menu\r\nimport TimerAdjust from '../TimerPage/Menu/TimerAdjust'\r\nimport FriendsList from '../TimerPage/Menu/FriendsList'\r\nimport ItemShop from '../TimerPage/Menu/ItemShop'\r\n\r\nfunction TimerPage() {\r\n\r\n    const [ pomodoro , setPomodoro ] = useState(25)\r\n    const [ shortBreak , setShortBreak ] = useState(5)\r\n    const [ longBreak , setLongBreak ] = useState(20)\r\n    const [ timerSeconds , setTimerSeconds ] = useState(TimeMath.convMinSec(pomodoro))\r\n    const [ timerMode , setTimerMode ] = useState('Questing')\r\n    const [ isRunning, setIsRunning ] = useState(false)\r\n    const [ pomosCompleted, setPomosCompleted ] = useState(0);\r\n    const [ activeTask, setActiveTask ] = useState('')\r\n    const [ character, setCharacter ] = useState({char_name: \"\", stats: {}, inventory: []})\r\n    // Can probably refactor this into a smaller component, but for now it is easier to see how everything working\r\n    // Gold: Plus 20 gold per each finished study timer,\r\n    // plus 100 per each long break achieved\r\n    //\r\n    // XP: Plus 50 xp per each finished study timer,\r\n    // plus 200 for each long break achieved\r\n    //\r\n    const questComplete = (type) => {\r\n\r\n        let updatedXp = type === \"LC\" ? character.stats.current_xp + 100 : character.stats.current_xp + 50\r\n        const updatedGold = type === \"LC\" ? character.stats.gold + 100 : character.stats.gold + 50\r\n        let updatedLevel = character.stats.level\r\n        let updatedReqExp = character.stats.xp_to_next_level\r\n\r\n        if (updatedXp >= character.stats.xp_to_next_level) {\r\n            updatedXp = 0;\r\n            updatedLevel = updatedLevel + 1;\r\n            updatedReqExp = updatedReqExp + 100;\r\n        }\r\n\r\n        let updatedCharacter = {\r\n            current_xp: updatedXp,\r\n            gold: updatedGold,\r\n            level: updatedLevel,\r\n            xp_to_next_level: updatedReqExp\r\n        }\r\n\r\n        setCharacter({...character, stats: {...character.stats, gold: updatedGold, current_xp: updatedXp, level: updatedLevel, xp_to_next_level: updatedReqExp}})\r\n        // error when trying to post a 0 to updatedXP stat\r\n        axios.put(`http://localhost:5000/api/v1/users/character`, updatedCharacter)\r\n            .then(r => console.log(r))\r\n            .catch(e => console.log(e.response))\r\n    }\r\n    const handleModeChange = () => {\r\n      if (timerMode === 'Questing' && pomosCompleted === 3){\r\n          setTimerMode('Long Camp');\r\n          setPomosCompleted(pomosCompleted => pomosCompleted + 1);\r\n          setTimerSeconds(TimeMath.convMinSec(longBreak));\r\n          questComplete(\"LC\")\r\n      }\r\n      else if (timerMode === 'Questing'){\r\n          setTimerMode('Short Camp');\r\n          setTimerSeconds(TimeMath.convMinSec(shortBreak));\r\n          setPomosCompleted(pomosCompleted => pomosCompleted + 1);\r\n          questComplete(\"Q\")\r\n      } else{\r\n          setTimerMode('Questing')\r\n          setTimerSeconds(TimeMath.convMinSec(pomodoro));\r\n\r\n      }\r\n    }\r\n    const timeoutID = 0;\r\n\r\n    useEffect(() => {\r\n        getUser()\r\n            .then(\r\n                response => {\r\n                    setCharacter(response.data)\r\n                }\r\n            )\r\n            .catch(error => {\r\n                console.log(error)\r\n            })\r\n\r\n    }, [] )\r\n\r\n    useEffect(() => {\r\n        if(isRunning && timerSeconds > 0) {\r\n            const timeoutID = setTimeout(() => {\r\n                setTimerSeconds(timerSeconds => timerSeconds - 1)\r\n            }, 1000)\r\n        }\r\n        if (timerSeconds === 0){\r\n            setIsRunning(false);\r\n            clearTimeout(timeoutID);\r\n            handleModeChange()\r\n        }\r\n        clearTimeout(timeoutID);\r\n    }, [isRunning, timerSeconds]);\r\n\r\n  return (\r\n          <Box sx={{\r\n              display: 'flex',\r\n              justifyContent: 'center',\r\n              textAlign: 'center',\r\n              alignItems: 'baseline',\r\n              pt: 5, pb: 5,\r\n          }}>\r\n\r\n              <RoomDisplay pomosCompleted={pomosCompleted} multiplier={1} />\r\n\r\n              <Box>\r\n                  <Box sx={{mb: 5, minWidth: 400}}>\r\n                      <LinearProgress variant='determinate' value={TimeMath.normalise(Math.abs(timerSeconds - TimeMath.convMinSec(pomodoro)),pomodoro)} sx={{height: 12, width: '100%'}}/>\r\n                      <Timer\r\n                          timerMode={timerMode}\r\n                          timer={TimeMath.formatSeconds(timerSeconds)}\r\n                          reward={pomosCompleted % 2 === 0 ? '`Gold`' : 'Exp'}\r\n                          activeTask = {activeTask}\r\n                      />\r\n                  </Box>\r\n                  <ButtonGroup variant={'contained'}>\r\n                      <Button onClick={() => setIsRunning(true)}>START</Button>\r\n                      <Button onClick={() => {\r\n                          setIsRunning(false)\r\n                          clearTimeout(timeoutID)\r\n                      }}>STOP</Button>\r\n                  </ButtonGroup>\r\n                <QuestDisplay setActiveTask={setActiveTask} />\r\n              </Box>\r\n\r\n              <Box sx={{ml: 10, width: '9%', display: 'flex', flexDirection: 'column', alignItems: 'center'}}>\r\n                  <CharacterDisplay character={character} setCharacter={setCharacter}/>\r\n                  <Stack direction={'row'}>\r\n                          <TimerAdjust pomodoro={pomodoro} setPomodoro={setPomodoro} shortBreak={shortBreak} setShortBreak={setShortBreak} longBreak={longBreak} setLongBreak={setLongBreak} setTimerSeconds={setTimerSeconds} />\r\n                          <FriendsList/>\r\n                          <ItemShop character={character} setCharacter={setCharacter} />\r\n                  </Stack>\r\n              </Box>\r\n          </Box>\r\n  );\r\n}\r\n\r\nexport default TimerPage;"]},"metadata":{},"sourceType":"module"}