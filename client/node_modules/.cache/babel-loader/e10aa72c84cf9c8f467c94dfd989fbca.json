{"ast":null,"code":"\"use strict\";\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function () {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Namespace = exports.Socket = exports.Server = void 0;\n\nconst http = require(\"http\");\n\nconst fs_1 = require(\"fs\");\n\nconst zlib_1 = require(\"zlib\");\n\nconst accepts = require(\"accepts\");\n\nconst stream_1 = require(\"stream\");\n\nconst path = require(\"path\");\n\nconst engine_io_1 = require(\"engine.io\");\n\nconst client_1 = require(\"./client\");\n\nconst events_1 = require(\"events\");\n\nconst namespace_1 = require(\"./namespace\");\n\nObject.defineProperty(exports, \"Namespace\", {\n  enumerable: true,\n  get: function () {\n    return namespace_1.Namespace;\n  }\n});\n\nconst parent_namespace_1 = require(\"./parent-namespace\");\n\nconst socket_io_adapter_1 = require(\"socket.io-adapter\");\n\nconst parser = __importStar(require(\"socket.io-parser\"));\n\nconst debug_1 = __importDefault(require(\"debug\"));\n\nconst socket_1 = require(\"./socket\");\n\nObject.defineProperty(exports, \"Socket\", {\n  enumerable: true,\n  get: function () {\n    return socket_1.Socket;\n  }\n});\n\nconst typed_events_1 = require(\"./typed-events\");\n\nconst uws_js_1 = require(\"./uws.js\");\n\nconst debug = (0, debug_1.default)(\"socket.io:server\");\n\nconst clientVersion = require(\"../package.json\").version;\n\nconst dotMapRegex = /\\.map/;\n\nclass Server extends typed_events_1.StrictEventEmitter {\n  constructor(srv) {\n    let opts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    super();\n    /**\r\n     * @private\r\n     */\n\n    this._nsps = new Map();\n    this.parentNsps = new Map();\n\n    if (\"object\" === typeof srv && srv instanceof Object && !srv.listen) {\n      opts = srv;\n      srv = undefined;\n    }\n\n    this.path(opts.path || \"/socket.io\");\n    this.connectTimeout(opts.connectTimeout || 45000);\n    this.serveClient(false !== opts.serveClient);\n    this._parser = opts.parser || parser;\n    this.encoder = new this._parser.Encoder();\n    this.adapter(opts.adapter || socket_io_adapter_1.Adapter);\n    this.sockets = this.of(\"/\");\n    this.opts = opts;\n    if (srv || typeof srv == \"number\") this.attach(srv);\n  }\n\n  serveClient(v) {\n    if (!arguments.length) return this._serveClient;\n    this._serveClient = v;\n    return this;\n  }\n  /**\r\n   * Executes the middleware for an incoming namespace not already created on the server.\r\n   *\r\n   * @param name - name of incoming namespace\r\n   * @param auth - the auth parameters\r\n   * @param fn - callback\r\n   *\r\n   * @private\r\n   */\n\n\n  _checkNamespace(name, auth, fn) {\n    if (this.parentNsps.size === 0) return fn(false);\n    const keysIterator = this.parentNsps.keys();\n\n    const run = () => {\n      const nextFn = keysIterator.next();\n\n      if (nextFn.done) {\n        return fn(false);\n      }\n\n      nextFn.value(name, auth, (err, allow) => {\n        if (err || !allow) {\n          return run();\n        }\n\n        if (this._nsps.has(name)) {\n          // the namespace was created in the meantime\n          debug(\"dynamic namespace %s already exists\", name);\n          return fn(this._nsps.get(name));\n        }\n\n        const namespace = this.parentNsps.get(nextFn.value).createChild(name);\n        debug(\"dynamic namespace %s was created\", name); // @ts-ignore\n\n        this.sockets.emitReserved(\"new_namespace\", namespace);\n        fn(namespace);\n      });\n    };\n\n    run();\n  }\n\n  path(v) {\n    if (!arguments.length) return this._path;\n    this._path = v.replace(/\\/$/, \"\");\n\n    const escapedPath = this._path.replace(/[-\\/\\\\^$*+?.()|[\\]{}]/g, \"\\\\$&\");\n\n    this.clientPathRegex = new RegExp(\"^\" + escapedPath + \"/socket\\\\.io(\\\\.msgpack|\\\\.esm)?(\\\\.min)?\\\\.js(\\\\.map)?(?:\\\\?|$)\");\n    return this;\n  }\n\n  connectTimeout(v) {\n    if (v === undefined) return this._connectTimeout;\n    this._connectTimeout = v;\n    return this;\n  }\n\n  adapter(v) {\n    if (!arguments.length) return this._adapter;\n    this._adapter = v;\n\n    for (const nsp of this._nsps.values()) {\n      nsp._initAdapter();\n    }\n\n    return this;\n  }\n  /**\r\n   * Attaches socket.io to a server or port.\r\n   *\r\n   * @param srv - server or port\r\n   * @param opts - options passed to engine.io\r\n   * @return self\r\n   * @public\r\n   */\n\n\n  listen(srv) {\n    let opts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    return this.attach(srv, opts);\n  }\n  /**\r\n   * Attaches socket.io to a server or port.\r\n   *\r\n   * @param srv - server or port\r\n   * @param opts - options passed to engine.io\r\n   * @return self\r\n   * @public\r\n   */\n\n\n  attach(srv) {\n    let opts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    if (\"function\" == typeof srv) {\n      const msg = \"You are trying to attach socket.io to an express \" + \"request handler function. Please pass a http.Server instance.\";\n      throw new Error(msg);\n    } // handle a port as a string\n\n\n    if (Number(srv) == srv) {\n      srv = Number(srv);\n    }\n\n    if (\"number\" == typeof srv) {\n      debug(\"creating http server and binding to %d\", srv);\n      const port = srv;\n      srv = http.createServer((req, res) => {\n        res.writeHead(404);\n        res.end();\n      });\n      srv.listen(port);\n    } // merge the options passed to the Socket.IO server\n\n\n    Object.assign(opts, this.opts); // set engine.io path to `/socket.io`\n\n    opts.path = opts.path || this._path;\n    this.initEngine(srv, opts);\n    return this;\n  }\n\n  attachApp(app\n  /*: TemplatedApp */\n  ) {\n    let opts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    // merge the options passed to the Socket.IO server\n    Object.assign(opts, this.opts); // set engine.io path to `/socket.io`\n\n    opts.path = opts.path || this._path; // initialize engine\n\n    debug(\"creating uWebSockets.js-based engine with opts %j\", opts);\n    const engine = new engine_io_1.uServer(opts);\n    engine.attach(app, opts); // bind to engine events\n\n    this.bind(engine);\n\n    if (this._serveClient) {\n      // attach static file serving\n      app.get(`${this._path}/*`, (res, req) => {\n        if (!this.clientPathRegex.test(req.getUrl())) {\n          req.setYield(true);\n          return;\n        }\n\n        const filename = req.getUrl().replace(this._path, \"\").replace(/\\?.*$/, \"\").replace(/^\\//, \"\");\n        const isMap = dotMapRegex.test(filename);\n        const type = isMap ? \"map\" : \"source\"; // Per the standard, ETags must be quoted:\n        // https://tools.ietf.org/html/rfc7232#section-2.3\n\n        const expectedEtag = '\"' + clientVersion + '\"';\n        const weakEtag = \"W/\" + expectedEtag;\n        const etag = req.getHeader(\"if-none-match\");\n\n        if (etag) {\n          if (expectedEtag === etag || weakEtag === etag) {\n            debug(\"serve client %s 304\", type);\n            res.writeStatus(\"304 Not Modified\");\n            res.end();\n            return;\n          }\n        }\n\n        debug(\"serve client %s\", type);\n        res.writeHeader(\"cache-control\", \"public, max-age=0\");\n        res.writeHeader(\"content-type\", \"application/\" + (isMap ? \"json\" : \"javascript\"));\n        res.writeHeader(\"etag\", expectedEtag);\n        const filepath = path.join(__dirname, \"../client-dist/\", filename);\n        (0, uws_js_1.serveFile)(res, filepath);\n      });\n    }\n\n    (0, uws_js_1.patchAdapter)(app);\n  }\n  /**\r\n   * Initialize engine\r\n   *\r\n   * @param srv - the server to attach to\r\n   * @param opts - options passed to engine.io\r\n   * @private\r\n   */\n\n\n  initEngine(srv, opts) {\n    // initialize engine\n    debug(\"creating engine.io instance with opts %j\", opts);\n    this.eio = (0, engine_io_1.attach)(srv, opts); // attach static file serving\n\n    if (this._serveClient) this.attachServe(srv); // Export http server\n\n    this.httpServer = srv; // bind to engine events\n\n    this.bind(this.eio);\n  }\n  /**\r\n   * Attaches the static file serving.\r\n   *\r\n   * @param srv http server\r\n   * @private\r\n   */\n\n\n  attachServe(srv) {\n    debug(\"attaching client serving req handler\");\n    const evs = srv.listeners(\"request\").slice(0);\n    srv.removeAllListeners(\"request\");\n    srv.on(\"request\", (req, res) => {\n      if (this.clientPathRegex.test(req.url)) {\n        this.serve(req, res);\n      } else {\n        for (let i = 0; i < evs.length; i++) {\n          evs[i].call(srv, req, res);\n        }\n      }\n    });\n  }\n  /**\r\n   * Handles a request serving of client source and map\r\n   *\r\n   * @param req\r\n   * @param res\r\n   * @private\r\n   */\n\n\n  serve(req, res) {\n    const filename = req.url.replace(this._path, \"\").replace(/\\?.*$/, \"\");\n    const isMap = dotMapRegex.test(filename);\n    const type = isMap ? \"map\" : \"source\"; // Per the standard, ETags must be quoted:\n    // https://tools.ietf.org/html/rfc7232#section-2.3\n\n    const expectedEtag = '\"' + clientVersion + '\"';\n    const weakEtag = \"W/\" + expectedEtag;\n    const etag = req.headers[\"if-none-match\"];\n\n    if (etag) {\n      if (expectedEtag === etag || weakEtag === etag) {\n        debug(\"serve client %s 304\", type);\n        res.writeHead(304);\n        res.end();\n        return;\n      }\n    }\n\n    debug(\"serve client %s\", type);\n    res.setHeader(\"Cache-Control\", \"public, max-age=0\");\n    res.setHeader(\"Content-Type\", \"application/\" + (isMap ? \"json\" : \"javascript\"));\n    res.setHeader(\"ETag\", expectedEtag);\n    Server.sendFile(filename, req, res);\n  }\n  /**\r\n   * @param filename\r\n   * @param req\r\n   * @param res\r\n   * @private\r\n   */\n\n\n  static sendFile(filename, req, res) {\n    const readStream = (0, fs_1.createReadStream)(path.join(__dirname, \"../client-dist/\", filename));\n    const encoding = accepts(req).encodings([\"br\", \"gzip\", \"deflate\"]);\n\n    const onError = err => {\n      if (err) {\n        res.end();\n      }\n    };\n\n    switch (encoding) {\n      case \"br\":\n        res.writeHead(200, {\n          \"content-encoding\": \"br\"\n        });\n        readStream.pipe((0, zlib_1.createBrotliCompress)()).pipe(res);\n        (0, stream_1.pipeline)(readStream, (0, zlib_1.createBrotliCompress)(), res, onError);\n        break;\n\n      case \"gzip\":\n        res.writeHead(200, {\n          \"content-encoding\": \"gzip\"\n        });\n        (0, stream_1.pipeline)(readStream, (0, zlib_1.createGzip)(), res, onError);\n        break;\n\n      case \"deflate\":\n        res.writeHead(200, {\n          \"content-encoding\": \"deflate\"\n        });\n        (0, stream_1.pipeline)(readStream, (0, zlib_1.createDeflate)(), res, onError);\n        break;\n\n      default:\n        res.writeHead(200);\n        (0, stream_1.pipeline)(readStream, res, onError);\n    }\n  }\n  /**\r\n   * Binds socket.io to an engine.io instance.\r\n   *\r\n   * @param {engine.Server} engine engine.io (or compatible) server\r\n   * @return self\r\n   * @public\r\n   */\n\n\n  bind(engine) {\n    this.engine = engine;\n    this.engine.on(\"connection\", this.onconnection.bind(this));\n    return this;\n  }\n  /**\r\n   * Called with each incoming transport connection.\r\n   *\r\n   * @param {engine.Socket} conn\r\n   * @return self\r\n   * @private\r\n   */\n\n\n  onconnection(conn) {\n    debug(\"incoming connection with id %s\", conn.id);\n    const client = new client_1.Client(this, conn);\n\n    if (conn.protocol === 3) {\n      // @ts-ignore\n      client.connect(\"/\");\n    }\n\n    return this;\n  }\n  /**\r\n   * Looks up a namespace.\r\n   *\r\n   * @param {String|RegExp|Function} name nsp name\r\n   * @param fn optional, nsp `connection` ev handler\r\n   * @public\r\n   */\n\n\n  of(name, fn) {\n    if (typeof name === \"function\" || name instanceof RegExp) {\n      const parentNsp = new parent_namespace_1.ParentNamespace(this);\n      debug(\"initializing parent namespace %s\", parentNsp.name);\n\n      if (typeof name === \"function\") {\n        this.parentNsps.set(name, parentNsp);\n      } else {\n        this.parentNsps.set((nsp, conn, next) => next(null, name.test(nsp)), parentNsp);\n      }\n\n      if (fn) {\n        // @ts-ignore\n        parentNsp.on(\"connect\", fn);\n      }\n\n      return parentNsp;\n    }\n\n    if (String(name)[0] !== \"/\") name = \"/\" + name;\n\n    let nsp = this._nsps.get(name);\n\n    if (!nsp) {\n      debug(\"initializing namespace %s\", name);\n      nsp = new namespace_1.Namespace(this, name);\n\n      this._nsps.set(name, nsp);\n\n      if (name !== \"/\") {\n        // @ts-ignore\n        this.sockets.emitReserved(\"new_namespace\", nsp);\n      }\n    }\n\n    if (fn) nsp.on(\"connect\", fn);\n    return nsp;\n  }\n  /**\r\n   * Closes server connection\r\n   *\r\n   * @param [fn] optional, called as `fn([err])` on error OR all conns closed\r\n   * @public\r\n   */\n\n\n  close(fn) {\n    for (const socket of this.sockets.sockets.values()) {\n      socket._onclose(\"server shutting down\");\n    }\n\n    this.engine.close(); // restore the Adapter prototype\n\n    (0, uws_js_1.restoreAdapter)();\n\n    if (this.httpServer) {\n      this.httpServer.close(fn);\n    } else {\n      fn && fn();\n    }\n  }\n  /**\r\n   * Sets up namespace middleware.\r\n   *\r\n   * @return self\r\n   * @public\r\n   */\n\n\n  use(fn) {\n    this.sockets.use(fn);\n    return this;\n  }\n  /**\r\n   * Targets a room when emitting.\r\n   *\r\n   * @param room\r\n   * @return self\r\n   * @public\r\n   */\n\n\n  to(room) {\n    return this.sockets.to(room);\n  }\n  /**\r\n   * Targets a room when emitting.\r\n   *\r\n   * @param room\r\n   * @return self\r\n   * @public\r\n   */\n\n\n  in(room) {\n    return this.sockets.in(room);\n  }\n  /**\r\n   * Excludes a room when emitting.\r\n   *\r\n   * @param name\r\n   * @return self\r\n   * @public\r\n   */\n\n\n  except(name) {\n    return this.sockets.except(name);\n  }\n  /**\r\n   * Sends a `message` event to all clients.\r\n   *\r\n   * @return self\r\n   * @public\r\n   */\n\n\n  send() {\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    this.sockets.emit(\"message\", ...args);\n    return this;\n  }\n  /**\r\n   * Sends a `message` event to all clients.\r\n   *\r\n   * @return self\r\n   * @public\r\n   */\n\n\n  write() {\n    for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n      args[_key2] = arguments[_key2];\n    }\n\n    this.sockets.emit(\"message\", ...args);\n    return this;\n  }\n  /**\r\n   * Emit a packet to other Socket.IO servers\r\n   *\r\n   * @param ev - the event name\r\n   * @param args - an array of arguments, which may include an acknowledgement callback at the end\r\n   * @public\r\n   */\n\n\n  serverSideEmit(ev) {\n    for (var _len3 = arguments.length, args = new Array(_len3 > 1 ? _len3 - 1 : 0), _key3 = 1; _key3 < _len3; _key3++) {\n      args[_key3 - 1] = arguments[_key3];\n    }\n\n    return this.sockets.serverSideEmit(ev, ...args);\n  }\n  /**\r\n   * Gets a list of socket ids.\r\n   *\r\n   * @public\r\n   */\n\n\n  allSockets() {\n    return this.sockets.allSockets();\n  }\n  /**\r\n   * Sets the compress flag.\r\n   *\r\n   * @param compress - if `true`, compresses the sending data\r\n   * @return self\r\n   * @public\r\n   */\n\n\n  compress(compress) {\n    return this.sockets.compress(compress);\n  }\n  /**\r\n   * Sets a modifier for a subsequent event emission that the event data may be lost if the client is not ready to\r\n   * receive messages (because of network slowness or other issues, or because they’re connected through long polling\r\n   * and is in the middle of a request-response cycle).\r\n   *\r\n   * @return self\r\n   * @public\r\n   */\n\n\n  get volatile() {\n    return this.sockets.volatile;\n  }\n  /**\r\n   * Sets a modifier for a subsequent event emission that the event data will only be broadcast to the current node.\r\n   *\r\n   * @return self\r\n   * @public\r\n   */\n\n\n  get local() {\n    return this.sockets.local;\n  }\n  /**\r\n   * Returns the matching socket instances\r\n   *\r\n   * @public\r\n   */\n\n\n  fetchSockets() {\n    return this.sockets.fetchSockets();\n  }\n  /**\r\n   * Makes the matching socket instances join the specified rooms\r\n   *\r\n   * @param room\r\n   * @public\r\n   */\n\n\n  socketsJoin(room) {\n    return this.sockets.socketsJoin(room);\n  }\n  /**\r\n   * Makes the matching socket instances leave the specified rooms\r\n   *\r\n   * @param room\r\n   * @public\r\n   */\n\n\n  socketsLeave(room) {\n    return this.sockets.socketsLeave(room);\n  }\n  /**\r\n   * Makes the matching socket instances disconnect\r\n   *\r\n   * @param close - whether to close the underlying connection\r\n   * @public\r\n   */\n\n\n  disconnectSockets() {\n    let close = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n    return this.sockets.disconnectSockets(close);\n  }\n\n}\n\nexports.Server = Server;\n/**\r\n * Expose main namespace (/).\r\n */\n\nconst emitterMethods = Object.keys(events_1.EventEmitter.prototype).filter(function (key) {\n  return typeof events_1.EventEmitter.prototype[key] === \"function\";\n});\nemitterMethods.forEach(function (fn) {\n  Server.prototype[fn] = function () {\n    return this.sockets[fn].apply(this.sockets, arguments);\n  };\n});\n\nmodule.exports = (srv, opts) => new Server(srv, opts);\n\nmodule.exports.Server = Server;\nmodule.exports.Namespace = namespace_1.Namespace;\nmodule.exports.Socket = socket_1.Socket;","map":{"version":3,"sources":["C:/Users/gabe/Desktop/Pomo/Team5/client/node_modules/socket.io/dist/index.js"],"names":["__createBinding","Object","create","o","m","k","k2","undefined","defineProperty","enumerable","get","__setModuleDefault","v","value","__importStar","mod","__esModule","result","prototype","hasOwnProperty","call","__importDefault","exports","Namespace","Socket","Server","http","require","fs_1","zlib_1","accepts","stream_1","path","engine_io_1","client_1","events_1","namespace_1","parent_namespace_1","socket_io_adapter_1","parser","debug_1","socket_1","typed_events_1","uws_js_1","debug","default","clientVersion","version","dotMapRegex","StrictEventEmitter","constructor","srv","opts","_nsps","Map","parentNsps","listen","connectTimeout","serveClient","_parser","encoder","Encoder","adapter","Adapter","sockets","of","attach","arguments","length","_serveClient","_checkNamespace","name","auth","fn","size","keysIterator","keys","run","nextFn","next","done","err","allow","has","namespace","createChild","emitReserved","_path","replace","escapedPath","clientPathRegex","RegExp","_connectTimeout","_adapter","nsp","values","_initAdapter","msg","Error","Number","port","createServer","req","res","writeHead","end","assign","initEngine","attachApp","app","engine","uServer","bind","test","getUrl","setYield","filename","isMap","type","expectedEtag","weakEtag","etag","getHeader","writeStatus","writeHeader","filepath","join","__dirname","serveFile","patchAdapter","eio","attachServe","httpServer","evs","listeners","slice","removeAllListeners","on","url","serve","i","headers","setHeader","sendFile","readStream","createReadStream","encoding","encodings","onError","pipe","createBrotliCompress","pipeline","createGzip","createDeflate","onconnection","conn","id","client","Client","protocol","connect","parentNsp","ParentNamespace","set","String","close","socket","_onclose","restoreAdapter","use","to","room","in","except","send","args","emit","write","serverSideEmit","ev","allSockets","compress","volatile","local","fetchSockets","socketsJoin","socketsLeave","disconnectSockets","emitterMethods","EventEmitter","filter","key","forEach","apply","module"],"mappings":"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","sourcesContent":["\"use strict\";\r\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}));\r\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n});\r\nvar __importStar = (this && this.__importStar) || function (mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n};\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.Namespace = exports.Socket = exports.Server = void 0;\r\nconst http = require(\"http\");\r\nconst fs_1 = require(\"fs\");\r\nconst zlib_1 = require(\"zlib\");\r\nconst accepts = require(\"accepts\");\r\nconst stream_1 = require(\"stream\");\r\nconst path = require(\"path\");\r\nconst engine_io_1 = require(\"engine.io\");\r\nconst client_1 = require(\"./client\");\r\nconst events_1 = require(\"events\");\r\nconst namespace_1 = require(\"./namespace\");\r\nObject.defineProperty(exports, \"Namespace\", { enumerable: true, get: function () { return namespace_1.Namespace; } });\r\nconst parent_namespace_1 = require(\"./parent-namespace\");\r\nconst socket_io_adapter_1 = require(\"socket.io-adapter\");\r\nconst parser = __importStar(require(\"socket.io-parser\"));\r\nconst debug_1 = __importDefault(require(\"debug\"));\r\nconst socket_1 = require(\"./socket\");\r\nObject.defineProperty(exports, \"Socket\", { enumerable: true, get: function () { return socket_1.Socket; } });\r\nconst typed_events_1 = require(\"./typed-events\");\r\nconst uws_js_1 = require(\"./uws.js\");\r\nconst debug = (0, debug_1.default)(\"socket.io:server\");\r\nconst clientVersion = require(\"../package.json\").version;\r\nconst dotMapRegex = /\\.map/;\r\nclass Server extends typed_events_1.StrictEventEmitter {\r\n    constructor(srv, opts = {}) {\r\n        super();\r\n        /**\r\n         * @private\r\n         */\r\n        this._nsps = new Map();\r\n        this.parentNsps = new Map();\r\n        if (\"object\" === typeof srv &&\r\n            srv instanceof Object &&\r\n            !srv.listen) {\r\n            opts = srv;\r\n            srv = undefined;\r\n        }\r\n        this.path(opts.path || \"/socket.io\");\r\n        this.connectTimeout(opts.connectTimeout || 45000);\r\n        this.serveClient(false !== opts.serveClient);\r\n        this._parser = opts.parser || parser;\r\n        this.encoder = new this._parser.Encoder();\r\n        this.adapter(opts.adapter || socket_io_adapter_1.Adapter);\r\n        this.sockets = this.of(\"/\");\r\n        this.opts = opts;\r\n        if (srv || typeof srv == \"number\")\r\n            this.attach(srv);\r\n    }\r\n    serveClient(v) {\r\n        if (!arguments.length)\r\n            return this._serveClient;\r\n        this._serveClient = v;\r\n        return this;\r\n    }\r\n    /**\r\n     * Executes the middleware for an incoming namespace not already created on the server.\r\n     *\r\n     * @param name - name of incoming namespace\r\n     * @param auth - the auth parameters\r\n     * @param fn - callback\r\n     *\r\n     * @private\r\n     */\r\n    _checkNamespace(name, auth, fn) {\r\n        if (this.parentNsps.size === 0)\r\n            return fn(false);\r\n        const keysIterator = this.parentNsps.keys();\r\n        const run = () => {\r\n            const nextFn = keysIterator.next();\r\n            if (nextFn.done) {\r\n                return fn(false);\r\n            }\r\n            nextFn.value(name, auth, (err, allow) => {\r\n                if (err || !allow) {\r\n                    return run();\r\n                }\r\n                if (this._nsps.has(name)) {\r\n                    // the namespace was created in the meantime\r\n                    debug(\"dynamic namespace %s already exists\", name);\r\n                    return fn(this._nsps.get(name));\r\n                }\r\n                const namespace = this.parentNsps.get(nextFn.value).createChild(name);\r\n                debug(\"dynamic namespace %s was created\", name);\r\n                // @ts-ignore\r\n                this.sockets.emitReserved(\"new_namespace\", namespace);\r\n                fn(namespace);\r\n            });\r\n        };\r\n        run();\r\n    }\r\n    path(v) {\r\n        if (!arguments.length)\r\n            return this._path;\r\n        this._path = v.replace(/\\/$/, \"\");\r\n        const escapedPath = this._path.replace(/[-\\/\\\\^$*+?.()|[\\]{}]/g, \"\\\\$&\");\r\n        this.clientPathRegex = new RegExp(\"^\" +\r\n            escapedPath +\r\n            \"/socket\\\\.io(\\\\.msgpack|\\\\.esm)?(\\\\.min)?\\\\.js(\\\\.map)?(?:\\\\?|$)\");\r\n        return this;\r\n    }\r\n    connectTimeout(v) {\r\n        if (v === undefined)\r\n            return this._connectTimeout;\r\n        this._connectTimeout = v;\r\n        return this;\r\n    }\r\n    adapter(v) {\r\n        if (!arguments.length)\r\n            return this._adapter;\r\n        this._adapter = v;\r\n        for (const nsp of this._nsps.values()) {\r\n            nsp._initAdapter();\r\n        }\r\n        return this;\r\n    }\r\n    /**\r\n     * Attaches socket.io to a server or port.\r\n     *\r\n     * @param srv - server or port\r\n     * @param opts - options passed to engine.io\r\n     * @return self\r\n     * @public\r\n     */\r\n    listen(srv, opts = {}) {\r\n        return this.attach(srv, opts);\r\n    }\r\n    /**\r\n     * Attaches socket.io to a server or port.\r\n     *\r\n     * @param srv - server or port\r\n     * @param opts - options passed to engine.io\r\n     * @return self\r\n     * @public\r\n     */\r\n    attach(srv, opts = {}) {\r\n        if (\"function\" == typeof srv) {\r\n            const msg = \"You are trying to attach socket.io to an express \" +\r\n                \"request handler function. Please pass a http.Server instance.\";\r\n            throw new Error(msg);\r\n        }\r\n        // handle a port as a string\r\n        if (Number(srv) == srv) {\r\n            srv = Number(srv);\r\n        }\r\n        if (\"number\" == typeof srv) {\r\n            debug(\"creating http server and binding to %d\", srv);\r\n            const port = srv;\r\n            srv = http.createServer((req, res) => {\r\n                res.writeHead(404);\r\n                res.end();\r\n            });\r\n            srv.listen(port);\r\n        }\r\n        // merge the options passed to the Socket.IO server\r\n        Object.assign(opts, this.opts);\r\n        // set engine.io path to `/socket.io`\r\n        opts.path = opts.path || this._path;\r\n        this.initEngine(srv, opts);\r\n        return this;\r\n    }\r\n    attachApp(app /*: TemplatedApp */, opts = {}) {\r\n        // merge the options passed to the Socket.IO server\r\n        Object.assign(opts, this.opts);\r\n        // set engine.io path to `/socket.io`\r\n        opts.path = opts.path || this._path;\r\n        // initialize engine\r\n        debug(\"creating uWebSockets.js-based engine with opts %j\", opts);\r\n        const engine = new engine_io_1.uServer(opts);\r\n        engine.attach(app, opts);\r\n        // bind to engine events\r\n        this.bind(engine);\r\n        if (this._serveClient) {\r\n            // attach static file serving\r\n            app.get(`${this._path}/*`, (res, req) => {\r\n                if (!this.clientPathRegex.test(req.getUrl())) {\r\n                    req.setYield(true);\r\n                    return;\r\n                }\r\n                const filename = req\r\n                    .getUrl()\r\n                    .replace(this._path, \"\")\r\n                    .replace(/\\?.*$/, \"\")\r\n                    .replace(/^\\//, \"\");\r\n                const isMap = dotMapRegex.test(filename);\r\n                const type = isMap ? \"map\" : \"source\";\r\n                // Per the standard, ETags must be quoted:\r\n                // https://tools.ietf.org/html/rfc7232#section-2.3\r\n                const expectedEtag = '\"' + clientVersion + '\"';\r\n                const weakEtag = \"W/\" + expectedEtag;\r\n                const etag = req.getHeader(\"if-none-match\");\r\n                if (etag) {\r\n                    if (expectedEtag === etag || weakEtag === etag) {\r\n                        debug(\"serve client %s 304\", type);\r\n                        res.writeStatus(\"304 Not Modified\");\r\n                        res.end();\r\n                        return;\r\n                    }\r\n                }\r\n                debug(\"serve client %s\", type);\r\n                res.writeHeader(\"cache-control\", \"public, max-age=0\");\r\n                res.writeHeader(\"content-type\", \"application/\" + (isMap ? \"json\" : \"javascript\"));\r\n                res.writeHeader(\"etag\", expectedEtag);\r\n                const filepath = path.join(__dirname, \"../client-dist/\", filename);\r\n                (0, uws_js_1.serveFile)(res, filepath);\r\n            });\r\n        }\r\n        (0, uws_js_1.patchAdapter)(app);\r\n    }\r\n    /**\r\n     * Initialize engine\r\n     *\r\n     * @param srv - the server to attach to\r\n     * @param opts - options passed to engine.io\r\n     * @private\r\n     */\r\n    initEngine(srv, opts) {\r\n        // initialize engine\r\n        debug(\"creating engine.io instance with opts %j\", opts);\r\n        this.eio = (0, engine_io_1.attach)(srv, opts);\r\n        // attach static file serving\r\n        if (this._serveClient)\r\n            this.attachServe(srv);\r\n        // Export http server\r\n        this.httpServer = srv;\r\n        // bind to engine events\r\n        this.bind(this.eio);\r\n    }\r\n    /**\r\n     * Attaches the static file serving.\r\n     *\r\n     * @param srv http server\r\n     * @private\r\n     */\r\n    attachServe(srv) {\r\n        debug(\"attaching client serving req handler\");\r\n        const evs = srv.listeners(\"request\").slice(0);\r\n        srv.removeAllListeners(\"request\");\r\n        srv.on(\"request\", (req, res) => {\r\n            if (this.clientPathRegex.test(req.url)) {\r\n                this.serve(req, res);\r\n            }\r\n            else {\r\n                for (let i = 0; i < evs.length; i++) {\r\n                    evs[i].call(srv, req, res);\r\n                }\r\n            }\r\n        });\r\n    }\r\n    /**\r\n     * Handles a request serving of client source and map\r\n     *\r\n     * @param req\r\n     * @param res\r\n     * @private\r\n     */\r\n    serve(req, res) {\r\n        const filename = req.url.replace(this._path, \"\").replace(/\\?.*$/, \"\");\r\n        const isMap = dotMapRegex.test(filename);\r\n        const type = isMap ? \"map\" : \"source\";\r\n        // Per the standard, ETags must be quoted:\r\n        // https://tools.ietf.org/html/rfc7232#section-2.3\r\n        const expectedEtag = '\"' + clientVersion + '\"';\r\n        const weakEtag = \"W/\" + expectedEtag;\r\n        const etag = req.headers[\"if-none-match\"];\r\n        if (etag) {\r\n            if (expectedEtag === etag || weakEtag === etag) {\r\n                debug(\"serve client %s 304\", type);\r\n                res.writeHead(304);\r\n                res.end();\r\n                return;\r\n            }\r\n        }\r\n        debug(\"serve client %s\", type);\r\n        res.setHeader(\"Cache-Control\", \"public, max-age=0\");\r\n        res.setHeader(\"Content-Type\", \"application/\" + (isMap ? \"json\" : \"javascript\"));\r\n        res.setHeader(\"ETag\", expectedEtag);\r\n        Server.sendFile(filename, req, res);\r\n    }\r\n    /**\r\n     * @param filename\r\n     * @param req\r\n     * @param res\r\n     * @private\r\n     */\r\n    static sendFile(filename, req, res) {\r\n        const readStream = (0, fs_1.createReadStream)(path.join(__dirname, \"../client-dist/\", filename));\r\n        const encoding = accepts(req).encodings([\"br\", \"gzip\", \"deflate\"]);\r\n        const onError = (err) => {\r\n            if (err) {\r\n                res.end();\r\n            }\r\n        };\r\n        switch (encoding) {\r\n            case \"br\":\r\n                res.writeHead(200, { \"content-encoding\": \"br\" });\r\n                readStream.pipe((0, zlib_1.createBrotliCompress)()).pipe(res);\r\n                (0, stream_1.pipeline)(readStream, (0, zlib_1.createBrotliCompress)(), res, onError);\r\n                break;\r\n            case \"gzip\":\r\n                res.writeHead(200, { \"content-encoding\": \"gzip\" });\r\n                (0, stream_1.pipeline)(readStream, (0, zlib_1.createGzip)(), res, onError);\r\n                break;\r\n            case \"deflate\":\r\n                res.writeHead(200, { \"content-encoding\": \"deflate\" });\r\n                (0, stream_1.pipeline)(readStream, (0, zlib_1.createDeflate)(), res, onError);\r\n                break;\r\n            default:\r\n                res.writeHead(200);\r\n                (0, stream_1.pipeline)(readStream, res, onError);\r\n        }\r\n    }\r\n    /**\r\n     * Binds socket.io to an engine.io instance.\r\n     *\r\n     * @param {engine.Server} engine engine.io (or compatible) server\r\n     * @return self\r\n     * @public\r\n     */\r\n    bind(engine) {\r\n        this.engine = engine;\r\n        this.engine.on(\"connection\", this.onconnection.bind(this));\r\n        return this;\r\n    }\r\n    /**\r\n     * Called with each incoming transport connection.\r\n     *\r\n     * @param {engine.Socket} conn\r\n     * @return self\r\n     * @private\r\n     */\r\n    onconnection(conn) {\r\n        debug(\"incoming connection with id %s\", conn.id);\r\n        const client = new client_1.Client(this, conn);\r\n        if (conn.protocol === 3) {\r\n            // @ts-ignore\r\n            client.connect(\"/\");\r\n        }\r\n        return this;\r\n    }\r\n    /**\r\n     * Looks up a namespace.\r\n     *\r\n     * @param {String|RegExp|Function} name nsp name\r\n     * @param fn optional, nsp `connection` ev handler\r\n     * @public\r\n     */\r\n    of(name, fn) {\r\n        if (typeof name === \"function\" || name instanceof RegExp) {\r\n            const parentNsp = new parent_namespace_1.ParentNamespace(this);\r\n            debug(\"initializing parent namespace %s\", parentNsp.name);\r\n            if (typeof name === \"function\") {\r\n                this.parentNsps.set(name, parentNsp);\r\n            }\r\n            else {\r\n                this.parentNsps.set((nsp, conn, next) => next(null, name.test(nsp)), parentNsp);\r\n            }\r\n            if (fn) {\r\n                // @ts-ignore\r\n                parentNsp.on(\"connect\", fn);\r\n            }\r\n            return parentNsp;\r\n        }\r\n        if (String(name)[0] !== \"/\")\r\n            name = \"/\" + name;\r\n        let nsp = this._nsps.get(name);\r\n        if (!nsp) {\r\n            debug(\"initializing namespace %s\", name);\r\n            nsp = new namespace_1.Namespace(this, name);\r\n            this._nsps.set(name, nsp);\r\n            if (name !== \"/\") {\r\n                // @ts-ignore\r\n                this.sockets.emitReserved(\"new_namespace\", nsp);\r\n            }\r\n        }\r\n        if (fn)\r\n            nsp.on(\"connect\", fn);\r\n        return nsp;\r\n    }\r\n    /**\r\n     * Closes server connection\r\n     *\r\n     * @param [fn] optional, called as `fn([err])` on error OR all conns closed\r\n     * @public\r\n     */\r\n    close(fn) {\r\n        for (const socket of this.sockets.sockets.values()) {\r\n            socket._onclose(\"server shutting down\");\r\n        }\r\n        this.engine.close();\r\n        // restore the Adapter prototype\r\n        (0, uws_js_1.restoreAdapter)();\r\n        if (this.httpServer) {\r\n            this.httpServer.close(fn);\r\n        }\r\n        else {\r\n            fn && fn();\r\n        }\r\n    }\r\n    /**\r\n     * Sets up namespace middleware.\r\n     *\r\n     * @return self\r\n     * @public\r\n     */\r\n    use(fn) {\r\n        this.sockets.use(fn);\r\n        return this;\r\n    }\r\n    /**\r\n     * Targets a room when emitting.\r\n     *\r\n     * @param room\r\n     * @return self\r\n     * @public\r\n     */\r\n    to(room) {\r\n        return this.sockets.to(room);\r\n    }\r\n    /**\r\n     * Targets a room when emitting.\r\n     *\r\n     * @param room\r\n     * @return self\r\n     * @public\r\n     */\r\n    in(room) {\r\n        return this.sockets.in(room);\r\n    }\r\n    /**\r\n     * Excludes a room when emitting.\r\n     *\r\n     * @param name\r\n     * @return self\r\n     * @public\r\n     */\r\n    except(name) {\r\n        return this.sockets.except(name);\r\n    }\r\n    /**\r\n     * Sends a `message` event to all clients.\r\n     *\r\n     * @return self\r\n     * @public\r\n     */\r\n    send(...args) {\r\n        this.sockets.emit(\"message\", ...args);\r\n        return this;\r\n    }\r\n    /**\r\n     * Sends a `message` event to all clients.\r\n     *\r\n     * @return self\r\n     * @public\r\n     */\r\n    write(...args) {\r\n        this.sockets.emit(\"message\", ...args);\r\n        return this;\r\n    }\r\n    /**\r\n     * Emit a packet to other Socket.IO servers\r\n     *\r\n     * @param ev - the event name\r\n     * @param args - an array of arguments, which may include an acknowledgement callback at the end\r\n     * @public\r\n     */\r\n    serverSideEmit(ev, ...args) {\r\n        return this.sockets.serverSideEmit(ev, ...args);\r\n    }\r\n    /**\r\n     * Gets a list of socket ids.\r\n     *\r\n     * @public\r\n     */\r\n    allSockets() {\r\n        return this.sockets.allSockets();\r\n    }\r\n    /**\r\n     * Sets the compress flag.\r\n     *\r\n     * @param compress - if `true`, compresses the sending data\r\n     * @return self\r\n     * @public\r\n     */\r\n    compress(compress) {\r\n        return this.sockets.compress(compress);\r\n    }\r\n    /**\r\n     * Sets a modifier for a subsequent event emission that the event data may be lost if the client is not ready to\r\n     * receive messages (because of network slowness or other issues, or because they’re connected through long polling\r\n     * and is in the middle of a request-response cycle).\r\n     *\r\n     * @return self\r\n     * @public\r\n     */\r\n    get volatile() {\r\n        return this.sockets.volatile;\r\n    }\r\n    /**\r\n     * Sets a modifier for a subsequent event emission that the event data will only be broadcast to the current node.\r\n     *\r\n     * @return self\r\n     * @public\r\n     */\r\n    get local() {\r\n        return this.sockets.local;\r\n    }\r\n    /**\r\n     * Returns the matching socket instances\r\n     *\r\n     * @public\r\n     */\r\n    fetchSockets() {\r\n        return this.sockets.fetchSockets();\r\n    }\r\n    /**\r\n     * Makes the matching socket instances join the specified rooms\r\n     *\r\n     * @param room\r\n     * @public\r\n     */\r\n    socketsJoin(room) {\r\n        return this.sockets.socketsJoin(room);\r\n    }\r\n    /**\r\n     * Makes the matching socket instances leave the specified rooms\r\n     *\r\n     * @param room\r\n     * @public\r\n     */\r\n    socketsLeave(room) {\r\n        return this.sockets.socketsLeave(room);\r\n    }\r\n    /**\r\n     * Makes the matching socket instances disconnect\r\n     *\r\n     * @param close - whether to close the underlying connection\r\n     * @public\r\n     */\r\n    disconnectSockets(close = false) {\r\n        return this.sockets.disconnectSockets(close);\r\n    }\r\n}\r\nexports.Server = Server;\r\n/**\r\n * Expose main namespace (/).\r\n */\r\nconst emitterMethods = Object.keys(events_1.EventEmitter.prototype).filter(function (key) {\r\n    return typeof events_1.EventEmitter.prototype[key] === \"function\";\r\n});\r\nemitterMethods.forEach(function (fn) {\r\n    Server.prototype[fn] = function () {\r\n        return this.sockets[fn].apply(this.sockets, arguments);\r\n    };\r\n});\r\nmodule.exports = (srv, opts) => new Server(srv, opts);\r\nmodule.exports.Server = Server;\r\nmodule.exports.Namespace = namespace_1.Namespace;\r\nmodule.exports.Socket = socket_1.Socket;\r\n"]},"metadata":{},"sourceType":"script"}