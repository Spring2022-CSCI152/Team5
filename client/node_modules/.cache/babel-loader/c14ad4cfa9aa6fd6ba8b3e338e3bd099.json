{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Johnny Dean\\\\Desktop\\\\fsosubmission\\\\merge\\\\client\\\\src\\\\components\\\\TimerPage\\\\TimerPage.js\";\nimport React, { useState, useEffect } from 'react';\nimport LinearProgress from '@mui/material/LinearProgress';\nimport Button from '@mui/material/Button';\nimport Box from '@mui/material/Box';\nimport Stack from '@mui/material/Stack';\nimport ButtonGroup from '@mui/material/ButtonGroup';\nimport axios from 'axios';\nimport Timer from './TimerDisplay/Timer';\nimport CharacterDisplay from './TimerDisplay/CharacterDisplay';\nimport RoomDisplay from './TimerDisplay/RoomDisplay';\nimport QuestDisplay from './TimerDisplay/QuestDisplay';\nimport TimeMath from '../../services/TimeMath'; // Menu\n\nimport TimerAdjust from '../TimerPage/Menu/TimerAdjust';\nimport FriendsList from '../TimerPage/Menu/FriendsList';\nimport ItemShop from '../TimerPage/Menu/ItemShop';\n\nfunction TimerPage() {\n  const profile = JSON.parse(localStorage.getItem('profile'));\n  const userId = profile.result._id;\n  const [pomodoro, setPomodoro] = useState(.05);\n  const [shortBreak, setShortBreak] = useState(5);\n  const [longBreak, setLongBreak] = useState(20);\n  const [timerSeconds, setTimerSeconds] = useState(TimeMath.convMinSec(pomodoro));\n  const [timerMode, setTimerMode] = useState('Questing');\n  const [isRunning, setIsRunning] = useState(false);\n  const [pomosCompleted, setPomosCompleted] = useState(0);\n  const [activeTask, setActiveTask] = useState('');\n  const [character, setCharacterState] = useState({\n    char_name: \"\",\n    stats: {},\n    inventory: []\n  }); // Can probably refactor this into a smaller component, but for now it is easier to see how everything working\n  // Gold: Plus 20 gold per each finished study timer,\n  // plus 100 per each long break achieved\n  //\n  // XP: Plus 50 xp per each finished study timer,\n  // plus 200 for each long break achieved\n  //\n\n  const questComplete = type => {\n    let updatedXp = type === \"LC\" ? character.stats.current_xp + 100 : character.stats.current_xp + 50;\n    const updatedGold = type === \"LC\" ? character.stats.gold + 100 : character.stats.gold + 50;\n    let updatedLevel = character.stats.level;\n    let updatedReqExp = character.stats.xp_to_next_level;\n\n    if (updatedXp >= character.stats.xp_to_next_level) {\n      updatedXp = 0;\n      updatedLevel = updatedLevel + 1;\n      updatedReqExp = updatedReqExp + 100;\n    }\n\n    let updatedCharacter = {\n      user_id: userId,\n      current_xp: updatedXp,\n      gold: updatedGold,\n      level: updatedLevel,\n      xp_to_next_level: updatedReqExp\n    };\n    console.log(updatedXp);\n    setCharacterState({ ...character,\n      stats: { ...character.stats,\n        gold: updatedGold,\n        current_xp: updatedXp,\n        level: updatedLevel,\n        xp_to_next_level: updatedReqExp\n      }\n    });\n    axios.put(`http://localhost:5000/api/v1/users/character`, updatedCharacter).then(r => console.log(r)).catch(e => console.log(e.response));\n  };\n\n  const handleModeChange = () => {\n    if (timerMode === 'Questing' && pomosCompleted === 3) {\n      setTimerMode('Long Camp');\n      setPomosCompleted(pomosCompleted => pomosCompleted + 1);\n      setTimerSeconds(TimeMath.convMinSec(longBreak));\n      questComplete(\"LC\");\n    } else if (timerMode === 'Questing') {\n      setTimerMode('Short Camp');\n      setTimerSeconds(TimeMath.convMinSec(shortBreak));\n      setPomosCompleted(pomosCompleted => pomosCompleted + 1);\n      questComplete(\"Q\");\n    } else {\n      setTimerMode('Questing');\n      setTimerSeconds(TimeMath.convMinSec(pomodoro));\n    }\n  };\n\n  const timeoutID = 0;\n  useEffect(() => {\n    axios.get(`http://localhost:5000/api/v1/users/character?userId=${userId}`).then(response => {\n      setCharacterState(response.data);\n    }).catch(error => {\n      console.log(error);\n    });\n  }, []);\n  useEffect(() => {\n    if (isRunning && timerSeconds > 0) {\n      const timeoutID = setTimeout(() => {\n        setTimerSeconds(timerSeconds => timerSeconds - 1);\n      }, 1000);\n    }\n\n    if (timerSeconds === 0) {\n      setIsRunning(false);\n      clearTimeout(timeoutID);\n      handleModeChange();\n    }\n\n    clearTimeout(timeoutID);\n  }, [isRunning, timerSeconds]);\n  return /*#__PURE__*/React.createElement(Box, {\n    sx: {\n      display: 'flex',\n      justifyContent: 'center',\n      textAlign: 'center',\n      alignItems: 'baseline',\n      pt: 5,\n      pb: 5\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(RoomDisplay, {\n    pomosCompleted: pomosCompleted,\n    multiplier: 1,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 15\n    }\n  }), /*#__PURE__*/React.createElement(Box, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(Box, {\n    sx: {\n      mb: 5,\n      minWidth: 400\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 127,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(LinearProgress, {\n    variant: \"determinate\",\n    value: TimeMath.normalise(Math.abs(timerSeconds - TimeMath.convMinSec(pomodoro)), pomodoro),\n    sx: {\n      height: 12,\n      width: '100%'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 128,\n      columnNumber: 23\n    }\n  }), /*#__PURE__*/React.createElement(Timer, {\n    timerMode: timerMode,\n    timer: TimeMath.formatSeconds(timerSeconds),\n    reward: pomosCompleted % 2 === 0 ? '`Gold`' : 'Exp',\n    activeTask: activeTask,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 23\n    }\n  })), /*#__PURE__*/React.createElement(ButtonGroup, {\n    variant: 'contained',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 136,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    onClick: () => setIsRunning(true),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 137,\n      columnNumber: 23\n    }\n  }, \"START\"), /*#__PURE__*/React.createElement(Button, {\n    onClick: () => {\n      setIsRunning(false);\n      clearTimeout(timeoutID);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 138,\n      columnNumber: 23\n    }\n  }, \"STOP\")), /*#__PURE__*/React.createElement(QuestDisplay, {\n    setActiveTask: setActiveTask,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 143,\n      columnNumber: 17\n    }\n  })), /*#__PURE__*/React.createElement(Box, {\n    sx: {\n      ml: 10,\n      width: '9%',\n      display: 'flex',\n      flexDirection: 'column',\n      alignItems: 'center'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 146,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(CharacterDisplay, {\n    character: character,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 19\n    }\n  }), /*#__PURE__*/React.createElement(Stack, {\n    direction: 'row',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 148,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(TimerAdjust, {\n    pomodoro: pomodoro,\n    setPomodoro: setPomodoro,\n    shortBreak: shortBreak,\n    setShortBreak: setShortBreak,\n    longBreak: longBreak,\n    setLongBreak: setLongBreak,\n    setTimerSeconds: setTimerSeconds,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 27\n    }\n  }), /*#__PURE__*/React.createElement(FriendsList, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 27\n    }\n  }), /*#__PURE__*/React.createElement(ItemShop, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 27\n    }\n  }))));\n}\n\nexport default TimerPage;","map":{"version":3,"sources":["C:/Users/Johnny Dean/Desktop/fsosubmission/merge/client/src/components/TimerPage/TimerPage.js"],"names":["React","useState","useEffect","LinearProgress","Button","Box","Stack","ButtonGroup","axios","Timer","CharacterDisplay","RoomDisplay","QuestDisplay","TimeMath","TimerAdjust","FriendsList","ItemShop","TimerPage","profile","JSON","parse","localStorage","getItem","userId","result","_id","pomodoro","setPomodoro","shortBreak","setShortBreak","longBreak","setLongBreak","timerSeconds","setTimerSeconds","convMinSec","timerMode","setTimerMode","isRunning","setIsRunning","pomosCompleted","setPomosCompleted","activeTask","setActiveTask","character","setCharacterState","char_name","stats","inventory","questComplete","type","updatedXp","current_xp","updatedGold","gold","updatedLevel","level","updatedReqExp","xp_to_next_level","updatedCharacter","user_id","console","log","put","then","r","catch","e","response","handleModeChange","timeoutID","get","data","error","setTimeout","clearTimeout","display","justifyContent","textAlign","alignItems","pt","pb","mb","minWidth","normalise","Math","abs","height","width","formatSeconds","ml","flexDirection"],"mappings":"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","sourcesContent":["import React, {useState, useEffect} from 'react'\r\nimport LinearProgress from '@mui/material/LinearProgress';\r\nimport Button from '@mui/material/Button';\r\nimport Box from '@mui/material/Box';\r\nimport Stack from '@mui/material/Stack';\r\nimport ButtonGroup from '@mui/material/ButtonGroup';\r\nimport axios from 'axios';\r\n\r\nimport Timer from './TimerDisplay/Timer'\r\nimport CharacterDisplay from './TimerDisplay/CharacterDisplay'\r\nimport RoomDisplay from './TimerDisplay/RoomDisplay'\r\nimport QuestDisplay from './TimerDisplay/QuestDisplay'\r\nimport TimeMath from '../../services/TimeMath'\r\n// Menu\r\nimport TimerAdjust from '../TimerPage/Menu/TimerAdjust'\r\nimport FriendsList from '../TimerPage/Menu/FriendsList'\r\nimport ItemShop from '../TimerPage/Menu/ItemShop'\r\n\r\nfunction TimerPage() {\r\n    const profile = JSON.parse(localStorage.getItem('profile'))\r\n    const userId = profile.result._id\r\n    const [ pomodoro , setPomodoro ] = useState(.05)\r\n    const [ shortBreak , setShortBreak ] = useState(5)\r\n    const [ longBreak , setLongBreak ] = useState(20)\r\n    const [ timerSeconds , setTimerSeconds ] = useState(TimeMath.convMinSec(pomodoro))\r\n    const [ timerMode , setTimerMode ] = useState('Questing')\r\n    const [ isRunning, setIsRunning ] = useState(false)\r\n    const [ pomosCompleted, setPomosCompleted ] = useState(0);\r\n    const [ activeTask, setActiveTask ] = useState('')\r\n    const [ character, setCharacterState ] = useState({char_name: \"\", stats: {}, inventory: []})\r\n    // Can probably refactor this into a smaller component, but for now it is easier to see how everything working\r\n    // Gold: Plus 20 gold per each finished study timer,\r\n    // plus 100 per each long break achieved\r\n    //\r\n    // XP: Plus 50 xp per each finished study timer,\r\n    // plus 200 for each long break achieved\r\n    //\r\n    const questComplete = (type) => {\r\n\r\n        let updatedXp = type === \"LC\" ? character.stats.current_xp + 100 : character.stats.current_xp + 50\r\n        const updatedGold = type === \"LC\" ? character.stats.gold + 100 : character.stats.gold + 50\r\n        let updatedLevel = character.stats.level\r\n        let updatedReqExp = character.stats.xp_to_next_level\r\n\r\n        if (updatedXp >= character.stats.xp_to_next_level) {\r\n            updatedXp = 0;\r\n            updatedLevel = updatedLevel + 1;\r\n            updatedReqExp = updatedReqExp + 100;\r\n        }\r\n\r\n        let updatedCharacter = {\r\n            user_id: userId,\r\n            current_xp: updatedXp,\r\n            gold: updatedGold,\r\n            level: updatedLevel,\r\n            xp_to_next_level: updatedReqExp\r\n        }\r\n\r\n        console.log(updatedXp)\r\n        setCharacterState({...character, stats: {...character.stats, gold: updatedGold, current_xp: updatedXp, level: updatedLevel, xp_to_next_level: updatedReqExp}})\r\n        axios.put(`http://localhost:5000/api/v1/users/character`, updatedCharacter)\r\n            .then(r => console.log(r))\r\n            .catch(e => console.log(e.response))\r\n    }\r\n\r\n    const handleModeChange = () => {\r\n      if (timerMode === 'Questing' && pomosCompleted === 3){\r\n          setTimerMode('Long Camp');\r\n          setPomosCompleted(pomosCompleted => pomosCompleted + 1);\r\n          setTimerSeconds(TimeMath.convMinSec(longBreak));\r\n          questComplete(\"LC\")\r\n      }\r\n      else if (timerMode === 'Questing'){\r\n          setTimerMode('Short Camp');\r\n          setTimerSeconds(TimeMath.convMinSec(shortBreak));\r\n          setPomosCompleted(pomosCompleted => pomosCompleted + 1);\r\n          questComplete(\"Q\")\r\n      } else{\r\n          setTimerMode('Questing')\r\n          setTimerSeconds(TimeMath.convMinSec(pomodoro));\r\n\r\n      }\r\n    }\r\n\r\n    const timeoutID = 0;\r\n\r\n\r\n    useEffect(() => {\r\n        axios.get(`http://localhost:5000/api/v1/users/character?userId=${userId}`)\r\n            .then(\r\n                response => {\r\n                    setCharacterState(response.data)\r\n                }\r\n            )\r\n            .catch(error => {\r\n                console.log(error)\r\n            })\r\n\r\n    }, [] )\r\n\r\n    useEffect(() => {\r\n        if(isRunning && timerSeconds > 0) {\r\n            const timeoutID = setTimeout(() => {\r\n                setTimerSeconds(timerSeconds => timerSeconds - 1)\r\n            }, 1000)\r\n        }\r\n        if (timerSeconds === 0){\r\n            setIsRunning(false);\r\n            clearTimeout(timeoutID);\r\n            handleModeChange()\r\n        }\r\n        clearTimeout(timeoutID);\r\n    }, [isRunning, timerSeconds]);\r\n\r\n  return (\r\n          <Box sx={{\r\n              display: 'flex',\r\n              justifyContent: 'center',\r\n              textAlign: 'center',\r\n              alignItems: 'baseline',\r\n              pt: 5, pb: 5,\r\n          }}>\r\n\r\n              <RoomDisplay pomosCompleted={pomosCompleted} multiplier={1} />\r\n\r\n              <Box>\r\n                  <Box sx={{mb: 5, minWidth: 400}}>\r\n                      <LinearProgress variant='determinate' value={TimeMath.normalise(Math.abs(timerSeconds - TimeMath.convMinSec(pomodoro)),pomodoro)} sx={{height: 12, width: '100%'}}/>\r\n                      <Timer\r\n                          timerMode={timerMode}\r\n                          timer={TimeMath.formatSeconds(timerSeconds)}\r\n                          reward={pomosCompleted % 2 === 0 ? '`Gold`' : 'Exp'}\r\n                          activeTask = {activeTask}\r\n                      />\r\n                  </Box>\r\n                  <ButtonGroup variant={'contained'}>\r\n                      <Button onClick={() => setIsRunning(true)}>START</Button>\r\n                      <Button onClick={() => {\r\n                          setIsRunning(false)\r\n                          clearTimeout(timeoutID)\r\n                      }}>STOP</Button>\r\n                  </ButtonGroup>\r\n                <QuestDisplay setActiveTask={setActiveTask} />\r\n              </Box>\r\n\r\n              <Box sx={{ml: 10, width: '9%', display: 'flex', flexDirection: 'column', alignItems: 'center'}}>\r\n                  <CharacterDisplay character={character}/>\r\n                  <Stack direction={'row'}>\r\n                          <TimerAdjust pomodoro={pomodoro} setPomodoro={setPomodoro} shortBreak={shortBreak} setShortBreak={setShortBreak} longBreak={longBreak} setLongBreak={setLongBreak} setTimerSeconds={setTimerSeconds} />\r\n                          <FriendsList/>\r\n                          <ItemShop/>\r\n                  </Stack>\r\n              </Box>\r\n          </Box>\r\n  );\r\n}\r\n\r\nexport default TimerPage;\r\n"]},"metadata":{},"sourceType":"module"}